### Rustls CI 基准测试
CI 基准测试是持续基准测试的最佳工具。
它以两种不同的模式运行完全相同的基准测试：指令数模式和墙钟时间模式。
这是通过一个独创的自定义异步运行时实现的。
对于指令数模式，I/O 实际上仍然是阻塞的。
在内部，任务只在一次轮询中完成。
然后对于墙钟时间模式，I/O 真的是非阻塞的。
这允许模拟共享的内存缓冲区。
服务器和客户端交替进行轮询。
这使得 CI 基准测试可以消除异步运行时在其基准测试中的噪声和非确定性。

Rustls 选择使用 [cachegrind][cachegrind] 来跟踪 CPU 指令。
此决定是模仿 [Rust 编译器的持续基准测试解决方案][rustc perf]。
指令计数提供了一种非常稳定的方式来比较同一软件的两个版本。
这使其成为持续基准测试的理想选择。
然而，无法推断出指令计数增加的实际运行时成本。
指令增加 10% 不一定意味着运行性能增加 10%。
但是指令数量的大幅增加可能意味着运行性能有所增加。
因此，CI 基准测试也测量墙钟时间。

墙钟时间是 Rustls 项目真正关心的事情。
测量指令计数只是一个有用的代理。
基于指令计数的基准测试无法对使用相同数量指令但导致截然不同的墙钟时间性能的更改进行二者区分。
例如，新的算法可能恰好拥有完全相同的指令数，但运行速度慢两倍。

[cachegrind]: https://valgrind.org/docs/manual/cg-manual.html
[rustc perf]: https://github.com/rust-lang/rustc-perf